1. Удалены лишние пробелы
2. Заменены сравнения == != на is или is not
3. Переименованы переменные, которые вызывали переопределение
4. Добавил тип исключения
5. Добавил return во все ветки